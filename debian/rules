#!/usr/bin/make -f
export DH_OPTIONS

DEBARCH:=$(shell dpkg-architecture -qDEB_HOST_MULTIARCH)
export DH_VERBOSE=1
NPROCS:=$(shell grep -c ^processor /proc/cpuinfo)
export DEB_BUILD_OPTIONS=parallel=$(NPROCS)

%:
	dh $@ --parallel
	
override_dh_auto_configure:
	dh_auto_configure -- -DINSTALL_QBLUR_PLUGIN=ON \
		-DCMAKE_BUILD_TYPE=Release \
		-DCOMPILE_CC_CORE_LIB_WITH_CGAL=ON \
		-DINSTALL_QHPR_PLUGIN=ON \
		-DINSTALL_QPOISSON_RECON_PLUGIN=ON \
		-DPOISSON_RECON_WITH_OPEN_MP=ON \
		-DINSTALL_QEDL_PLUGIN=ON \
		-DINSTALL_QSRA_PLUGIN=ON \
		-DOPTION_USE_GDAL=ON \
		-DOPTION_USE_DXF_LIB=ON \
		-DINSTALL_QSSAO_PLUGIN=ON \
		-DOPTION_USE_LIBLAS=ON \
		-DINSTALL_QGMMREG_PLUGIN=ON \
		-DINSTALL_QANIMATION_PLUGIN=ON \
		-DINSTALL_QCSF_PLUGIN=ON \
                -DINSTALL_QPHOTOSCAN_IO_PLUGIN=ON \
		-DWITH_FFMPEG_SUPPORT=ON \
		-DFFMPEG_INCLUDE_DIR="/usr/include/$(DEBARCH)" \
		-DFFMPEG_LIBRARY_DIR="/usr/lib/$(DEBARCH)" \
		-DINSTALL_QFACETS_PLUGIN=ON \
		-DOPTION_USE_SHAPE_LIB=ON \
		-DINSTALL_QPCV_PLUGIN=ON \
                -DINSTALL_QM3C2_PLUGIN=ON \
		-DINSTALL_QBROOM_PLUGIN=true \
		-DINSTALL_QHOUGH_NORMALS_PLUGIN=true \
		-DEIGEN_ROOT_DIR=/usr/include/eigen3 \
		-DLIBLAS_INCLUDE_DIR="/usr/include" \
		-DLIBLAS_RELEASE_LIBRARY_FILE="/usr/lib/liblas.so" 

override_dh_shlibdeps:
	dh_shlibdeps -l/usr/lib/cloudcompare
